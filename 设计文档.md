这是虚幻蓝图性能分析插件功能设计方案。如果与虚幻5.6版本不兼容，请更换方案。

设计核心理念：运行时诊断逻辑瓶颈，编辑器时扫描资产健康，全流程可视化交互。

一、 核心架构总览

插件分为三个主要子系统：Runtime Profiler（运行时分析器）、Static Linter（静态扫描器）、Memory Analyzer（引用与内存分析器），统一汇聚于 Dashboard UI。

二、 模块功能与技术栈
1. 运行时分析器 (Runtime Profiler)

功能目标： 在 PIE (Play In Editor) 模式下，实时监控蓝图节点的执行频率和耗时，解决“逻辑卡顿”和“循环滥用”。

功能点：

录制控制： 提供“开始录制”、“停止录制”、“重置数据”按钮。

节点级计数器： 统计每个节点在录制期间的总执行次数、每秒平均执行次数。

高频报警： 自动标记每秒执行超过阈值（如 1000 次）的“热点节点”。

Tick 滥用检测： 专门列出开启了 Event Tick 且逻辑复杂的 Actor。

节点跳转： 双击整理好的数据，可以直接跳转到对应节点。

关键技术/API：

数据钩子： FBlueprintCoreDelegates::OnScriptInstrumentationSignal (核心，用于拦截节点执行)。

对象追踪： FWeakObjectPtr (防止分析过程中对象销毁导致崩溃)。

编辑器状态： FEditorDelegates::BeginPIE, EndPIE (自动控制录制状态)。

节点跳转：FKismetEditorUtilities::BringKismetToFocusOnObject

2. 静态扫描器 (Static Linter)

功能目标： 无需运行游戏，在后台扫描资产库，清理“脏乱差”代码，解决“项目维护”问题。

功能点：

无效节点检测： 扫描所有蓝图，列出无效变量或函数（没有被引用的节点或函数）。

孤岛节点检测： 找出未连接任何执行引脚（Exec Pin）的纯计算节点（Pure Nodes）。

Cast 滥用检查： 扫描 For Loop 或 Tick 中包含硬引用 Cast To 的情况（建议改为 接口）。

后台批量处理： 支持全项目扫描或仅扫描选中文件夹（可以进行文件勾选操作）。

关键技术/API：

资产遍历： FAssetRegistryModule, GetAssetsByClass。

蓝图图表遍历： UBlueprint -> UEdGraph -> Nodes 数组。

节点类型判断： UK2Node (所有蓝图节点的基类), UK2Node_Variable (变量节点), UK2Node_DynamicCast (类型转换节点)。

异步任务： FScopedSlowTask (进度条), Async/ParallelFor (多线程加速扫描)。

3. 内存与引用分析器 (Memory Analyzer)

功能目标： 分析蓝图的“重量”，解决“加载卡顿”和“内存爆炸”。

功能点：

引用深度分析： 计算蓝图的包含大小 (Inclusive Size)，即加载该蓝图会连带加载多少资源。

硬引用链追踪： 找出哪个变量导致了巨大的资源引用（例如：UI 引用了 Boss 模型）。

大资源警报： 列出引用了超过特定大小（如 2048x2048 贴图）的蓝图变量。

关键技术/API：

引用查找： FReferenceFinder (查找对象引用的核心工具)。

资源大小： UObject::GetResourceSize, GetResourceSizeEx。

依赖分析： AssetRegistry::GetDependencies (获取资产间的依赖关系)。

4. 交互式仪表盘 (Dashboard UI)

功能目标： 数据展示中心，提供类似于 IDE 的调试体验。

功能点：

数据列表： 分类展示分析结果（节点名、所属蓝图、计数、严重程度）。

排序与过滤： 支持按“消耗”、“名称”、“类型”排序；搜索框过滤。

双击跳转： 双击列表中的某一行，自动打开对应蓝图，并聚焦 (Focus) 到具体那个节点。

导出报告： 支持将分析结果导出为 CSV 或 JSON。

关键技术/API：

UI 框架： Slate (UE 底层 UI), SListView (列表), STableViewBase (表格)。

编辑器导航： FKismetEditorUtilities::BringKismetToFocusOnObject (核心跳转功能)。

资产编辑器管理： FAssetEditorManager (用于打开蓝图编辑器窗口)。

三、 技术难度分级

静态扫描 (Easy): 纯逻辑遍历，风险低，API 完善。

UI 仪表盘 (Medium): Slate 代码量大，繁琐，但逻辑简单。

内存分析 (Medium): 引用算法需要小心递归死循环，计算量较大需优化。

运行时 Hook (Hard):

性能敏感： 数据采集代码必须极快，否则会把编辑器卡死。

稳定性： 容易因为对象生命周期（GC）问题导致 Crash。

图表绘制： 在现有蓝图节点上画“热力图”需要深入理解 GraphEditor 的渲染管线。

四、 建议开发顺序

UI 骨架 + 静态扫描 (先跑通流程，获得正向反馈)。

内存/引用分析 (完善资产管理功能)。

运行时数据采集 (核心难点，先只做数据 Log)。

运行时跳转与热力图 (最后的交互体验优化)。